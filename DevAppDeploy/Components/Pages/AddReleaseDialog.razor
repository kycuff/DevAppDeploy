@using DevAppDeploy.Models
@using DevAppDeploy.Services.Application
@using DevAppDeploy.Services.Blob
@using MudBlazor
@using System.ComponentModel.DataAnnotations

<MudDialog>
    <TitleContent>
        Add App
    </TitleContent>
    <DialogContent>
        <MudForm @ref="form">
            <MudTextField @bind-Value="version" Label="Version" Required="true" />
            <MudTextField @bind-Value="unique" Label="Unique" Required="true" />
        </MudForm>
        <MudStack Style="width: 100%">
            <MudForm Model="@_model"
                     @bind-IsValid="_isValid"
                     @bind-IsTouched="_isTouched">
                <MudItem xs="12">
                    <MudFileUpload T="IReadOnlyList<IBrowserFile>"
                                   @ref="_fileUpload"
                                   @bind-Files="_model.Files"
                                   For="@(() => _model.Files)"
                                   AppendMultipleFiles
                                   Hidden="false"
                                   InputClass="absolute mud-width-full mud-height-full overflow-hidden z-10"
                                   InputStyle="opacity:0"
                                   tabindex="-1"
                                   @ondrop="ClearDragClass"
                                   @ondragenter="SetDragClass"
                                   @ondragleave="ClearDragClass"
                                   @ondragend="ClearDragClass">
                        <ActivatorContent>
                            <MudPaper Height="300px"
                                      Outlined="true"
                                      Class="@_dragClass">
                                <MudText Typo="Typo.h6">
                                    Drag and drop files here or click
                                </MudText>
                                @foreach (var file in _model.Files?.Select(file => file.Name) ?? Enumerable.Empty<string>())
                                {
                                    <MudChip T="string" Color="Color.Dark" Text="@file" />
                                }
                            </MudPaper>
                        </ActivatorContent>
                    </MudFileUpload>
                    <MudToolBar Gutters="false"
                                Class="relative d-flex justify-end gap-4">
                        <MudButton Color="Color.Primary"
                                   OnClick="OpenFilePickerAsync"
                                   Variant="Variant.Filled">
                            Open file picker
                        </MudButton>
                        <MudButton Color="Color.Error"
                                   Disabled="@(_model.Files is null || !_model.Files.Any())"
                                   OnClick="ClearAsync"
                                   Variant="Variant.Filled">
                            Clear
                        </MudButton>
                    </MudToolBar>
                </MudItem>
                <MudItem>
                    @if (_fileUpload?.ValidationErrors.Any() ?? false)
                    {
                        <MudText Color="Color.Error"
                                 Typo="Typo.caption">
                            @_fileUpload?.ValidationErrors[0]
                        </MudText>
                    }
                </MudItem>
                <MudItem xs="12">
                    IsValid: @_isValid - IsTouched: @_isTouched
                </MudItem>
            </MudForm>
        </MudStack>

    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
        <MudButton Color="Color.Primary" OnClick="Submit">Ok</MudButton>
    </DialogActions>
</MudDialog>


